<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Gestión de Servicios Web</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #eef2f5;
      padding: 40px;
    }
    .container {
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 30px;
    }
    label {
      display: block;
      margin-top: 20px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="file"] {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #0078D7;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    .dashboard {
      margin-top: 40px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    a {
      color: #0078D7;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Gestión de páginas y aplicaciones web</h2>

    <label for="host">Nombre del host</label>
    <input type="text" id="host" name="host" placeholder="Ej. paisajes">

    <button onclick="crear()"> aceptar </button>

    <label for="contenido">Contenido web (comprimido)</label>
    <input type="file" id="contenido" name="contenido" accept=".zip,.tar.gz">

    <button onclick="publicar()">Publicar servicio</button>

    <div class="dashboard">
      <h3>Registro de actividad</h3>
      <table id="tablaInstancias">
        <thead>
          <tr>
            <th>Host</th>
            <th>IP</th>
            <th>Enlace</th>
            <th>Fecha de creación</th>
            <th> </th>
          </tr>
        </thead>
        <tbody>
          <!-- Se llenará dinámicamente -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    async function crear(){
      const host = document.getElementById('host').value;

      if (!host) {
        alert("Por favor ingresa un nombre de host y selecciona un archivo.");
        return;
      }

      const formData = new FormData();
      formData.append("host", host);

      try {
        const response = await fetch("/crear", {
          method: "POST",
          body: formData
        });

        const resultado = await response.json();
        if (resultado.exito) {
          print("envio correcto")
        }
      } catch (error) {
        console.error("Error:", error);
        alert("No se pudo crear el servidor");
      }

    }
    async function publicar() {
      const host = document.getElementById('host').value;
      const archivo = document.getElementById('contenido').files[0];

      if (!host || !archivo) {
        alert("Por favor ingresa un nombre de host y selecciona un archivo.");
        return;
      }

      const formData = new FormData();
      formData.append("host", host);
      formData.append("contenido", archivo);

      try {
        const response = await fetch("/publicar", {
          method: "POST",
          body: formData
        });

        const resultado = await response.json();
        if (resultado.exito) {
          agregarInstancia(resultado.host, resultado.ip, resultado.url,resultado.fecha);
        } else {
          alert("Error al aprovisionar: " + resultado.mensaje);
        }
      } catch (error) {
        console.error("Error:", error);
        alert("No se pudo conectar con el servidor.");
      }
    }

    function agregarInstancia(host, ip, url,fecha) {
      const tabla = document.getElementById("tablaInstancias").querySelector("tbody");
      const fila = document.createElement("tr");

      fila.innerHTML = `
        <td>${host}</td>
        <td>${ip}</td>
        <td><a href="${url}" target="_blank">Ver página</a></td>
        <td>${fecha}</td>
        <td> <button onclick="eliminarFila(this)"> Eliminar </button> </td>
      `;

      tabla.appendChild(fila);
    }

    function eliminarFila(boton) {
      const fila = boton.closest("tr");
      const host = fila.cells[0].textContent;
      const ip = fila.cells[1].textContent;
      const url = fila.cells[2].querySelector("a").href;

      // Aquí puedes hacer lo que necesites con los datos
      console.log("Eliminando instancia:");
      console.log("Host:", host);
      console.log("IP:", ip);
      console.log("URL:", url);

      // Eliminar visualmente la fila
      fila.remove();

      // Opcional: enviar solicitud al backend para eliminar la instancia
      fetch("/eliminar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ host, ip, url })
      }).then(res => res.json())
        .then(data => console.log("Respuesta del servidor:", data));
      
    }
  </script>
</body>
</html>
